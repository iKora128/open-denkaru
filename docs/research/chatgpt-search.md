# 小規模医療機関向けオープンソース電子カルテ 要件定義

## 前提条件

* **汎用的な設計:** 診療科を特定せず、クリニック～小規模病院で共通に使える汎用的な電子カルテを目指します。入院機能は当面対象外（無床診療所を想定）ですが、将来的に有床診療所・小規模病院への対応も検討します。
* **段階的な開発:** まずは最小限のモックによるPoC（プロトタイプ1）から開発を開始し、その後プロトタイプ2～5で機能拡充と改善を段階的に行います。必要に応じてプロトタイプ6（+α）で先進的機能を追加します。
* **将来の連携要件:** ORCA（日本医師会 日医標準レセプトソフト）との連携によるレセプト（医事会計）処理や、FHIR標準APIへの対応は将来的に必須とします。また、可能であればSS-MIX2標準ストレージによるデータ連携も視野に入れます。厚生労働省も医療データ標準化の一環でSS-MIX2の活用を推進しており、異なるシステム間でのデータ交換にはHL7 FHIRの採用が重要となっています。
* **セキュリティ要件:** 認証・認可や操作履歴の監査ログ等のセキュリティ機能はプロトタイプ3以降で導入・強化します。それ以前の段階では簡易なシングルユーザ想定で開発し、徐々に多ユーザ環境に対応させます。
* **インフラストラクチャ:** 本システムはオンプレミス環境で動作することを前提とします（クラウド環境は想定しません）。各導入先の院内サーバーやローカルネットワーク上で稼働し、院外へのデータ送信は必要最小限（例：オンライン請求や標準API連携時のみ）に留めます。
* **技術スタック:** サーバーサイドはPythonを使用し、フロントエンドはTypeScriptを用いたWebアプリケーションとします。Pythonは医療データ処理やAI連携に強みがあり（例：PydicomによるDICOM医用画像の取り扱いや機械学習ライブラリの活用）、TypeScriptはモダンなUI開発によって利便性の高い画面を実現します。フロントエンドとバックエンドはRESTful API等で通信し、将来的なFHIRベースのAPI拡張にも対応しやすい構成とします。

## 必須機能（最低限必要な機能）

日本の医療機関で電子カルテに求められる基本的な機能を整理します。まず診療記録の管理や処方・オーダー入力といった**必須機能**を定義し、その後に**望ましい機能**（必須ではないが将来的にあると良い機能）を示します。

### 基本的な必須機能一覧

* **患者登録・基本情報管理:** 患者の基本情報（氏名、生年月日、性別、住所、連絡先など）や保険情報の登録・編集機能。PoC段階では手動入力で簡易登録できれば十分ですが、将来的にはレセコン(ORCA)に登録された患者基本情報を電子カルテ側へ自動連携できることが望ましいです。患者基本属性には、身長・体重・血液型といった身体情報やアレルギー・既往歴なども含め、診療に必要な事項を保持します。
* **患者検索・一覧表示:** 登録された患者を一覧し検索できる機能。受付済みの当日患者リストや全患者のリストを表示し、氏名やID、ふりがな、生年月日などで検索・ソート可能とします。特に外来では受付順や診療科別の並べ替えができると業務効率が上がります。
* **外来受付・来院管理:** （※小規模PoCでは簡略化可）来院した患者を受付登録し、診療待ちリストに反映する機能です。受付時に患者基本情報を確認し当日の診療予定に登録、診療室側ではその一覧から次の患者を呼び出せるようにします。受付業務と連携した患者一覧管理により、スムーズな診療順管理が可能となります。
* **診療録（電子カルテ記録）入力・参照:** 医師が診察内容を記録する電子カルテ本体の機能です。SOAP形式（Subjective/Objective/Assessment/Plan）などでの構造的な記載や、自由記載による経過メモの入力をサポートします。定型文やテンプレートの登録・引用機能を備え、よく使うフレーズを素早く呼び出せるようにします。記録した診療録は日時や記入者で検索・参照でき、過去の診療履歴を容易に閲覧可能とします。**監査ログ**として誰がいつ記録を入力・修正したかをすべて保存し、将来的に参照できるようにします。（監査ログ機能の具体的実装は後述のセキュリティ強化段階で）
* **処方（投薬）入力・管理:** 患者への投薬指示を入力する機能です。最小限のPoCでは、薬剤名や用法用量をテキスト入力する簡易的なもので構いませんが、将来的にはマスターデータから薬剤を選択できる仕組みに拡張します。処方入力時には併用禁忌薬や重複投与のチェックを行い、処方ミスを防止できることが望ましいです。院外処方箋を発行する場合は所定の様式で印刷できるようにし、院内調剤の場合でも投薬情報を記録・出力できるようにします。
* **検査・処置オーダー入力:** 血液検査や画像検査、処置などをオーダーする機能です。PoC段階では「検査項目名を記入しておく」程度の簡易な実装でも構いませんが、将来的には検査オーダーの登録時に臨床検査システムや外部検査会社へ電子的にオーダー情報を連携できるようにします。例えば、採血オーダー登録時にラベル印刷を行い、検査結果は後で電子カルテに自動取り込み・参照できることが理想です。画像検査オーダーについても放射線科システム/PACSへの依頼情報連携や結果レポートの取り込みを視野に入れます。
* **バイタルサイン記録:** 身長、体重、血圧、脈拍、体温などのバイタルサインを記録・参照する機能です。診療毎のバイタルを入力して保存し、必要に応じて時系列でグラフ表示するなど傾向を確認できるようにします。バイタル情報は診療録とともに表示され、医師が診療中に参照できるように設計します。例えば高血圧や糖尿病の患者では、過去の血圧や体重の推移を見ながら指導を行うことができます。
* **診断名・病名管理:** 患者の傷病名（診断名）を登録・管理する機能です。医師が診断した病名をICD-10コード等とともに記録し、現在治療中の病名や既往症を一覧できるようにします。保険請求上も主要病名の登録は必須となるため、本機能で登録した傷病名はレセコン側へ連携し算定情報として利用します。PoC段階ではテキスト入力でも良いですが、今後は標準病名マスターから選択・コード化できるよう拡張します。
* **カルテ参照・印刷:** 電子カルテに入力された診療録や処方内容を、見やすい形式で表示・印刷する機能です。例えば診療録を紙に出力して他院への紹介状作成の下敷きにしたり、患者への指導内容を書面で渡すといった用途を想定します。最低限、指定日の診療記録や当日の処方箋情報を画面表示し確認できるようにし、必要に応じて印刷可能にします。印刷物には患者基本情報や日時、記入者なども明記されるようにレイアウトします。

### 望ましい付加機能一覧（将来的にあると望ましい機能）

* **予約スケジュール管理:** 外来診療の予約機能や、当日の順番待ち管理の強化。将来的に予約システムと連携して予約情報を取り込み、予約一覧やタイムテーブル表示を行えるようにします。予約日時の変更、キャンセル待ち管理、リマインド通知（SMSやメール）なども付加機能として考慮します。
* **紹介状・各種文書作成:** 紹介状（診療情報提供書）や診断書、処方せん、領収書などの帳票をテンプレートから生成する機能です。紹介状についてはカルテ情報（傷病名、バイタル、検査結果、処方内容等）を引用しつつ作成し、電子的に他院と共有できることが望まれます。また、必要に応じ紙に印刷したりPDFで出力できるようにします。
* **在庫・物品管理:** 院内で薬剤を調剤する場合の薬品在庫管理や、注射・ワクチンなどの在庫管理機能です。処方や注射オーダーと連動して在庫数を減算し、在庫切れアラートや有効期限管理などを行えると望ましいです。ただし小規模クリニックでは外部薬局利用が多いため、必須ではありません。
* **患者ポータル連携:** 患者が自分のカルテ情報や検査結果にアクセスできるポータルサイト・アプリとの連携。将来的にFHIR API経由で患者自身のスマホアプリからデータを取得したり、オンライン診療で患者が入力した問診情報をカルテに取り込むなど、患者参加型の機能拡張も考えられます。
* **入院機能（病棟管理）:** 小規模病院や有床診療所向けに、入退院管理や病床管理、看護記録などの入院機能も将来的には追加可能です。具体的には入院患者のカルテ、投薬管理（入院オーダリング）、看護計画・経過記録、検温表、食事指示箋などのモジュールです。標準型電子カルテのα版では入院機能が範囲外となっていますが、必要に応じてオプション機能として開発を検討します。
* **医用画像連携（PACS統合）:** レントゲンやMRIなどの医用画像を電子カルテ上で参照できるよう、PACS（画像保管通信システム）との連携機能を備えます。具体的には、画像検査装置で撮影されたDICOM画像をPACSサーバー経由で取得し、電子カルテ画面にサムネイル表示したり拡大表示できるようにします。またカルテ記載中に参照したい重要画像（キー画像）を診療録に添付保存したり、紹介状に転記する機能もあると便利です。PythonのPydicomライブラリを用いてDICOM画像を処理し、Webブラウザ上で表示する仕組みを構築します。
* **各種アラート・意思決定支援:** 患者の状況に応じて警告や支援情報を表示する機能です。例えば、過去のアレルギー情報に基づき処方入力時に警告を出す、副作用歴のある薬剤を処方しようとした際にアラートを表示するといった安全対策機能を想定しています。また、最新の診療ガイドラインに基づく注意喚起（例：「この数値なら〇〇検査を追加推奨」等）や、投与量の自動計算補助なども将来的な付加機能として考えられます。

## 画面構成（UI）と主要ページ

本システムで必要となる主な画面（ページ）とその機能を示します。UIはシンプルで見やすく、必要な情報に迅速にアクセスできることを重視します。各画面は用途ごとにモジュール化し、論理的なメニュー構成とします。

* **ログイン画面（ユーザ認証）:** （プロトタイプ3以降）ユーザID・パスワードを入力しシステムにログインする画面です。医師、看護師、事務など役割に応じてアクセス権を付与します。必要に応じて二要素認証（例: 認証アプリやICカード）にも対応し、医療情報への不正アクセスを防止します。
* **患者一覧ページ:** 現在登録されている患者を一覧表示する画面です。氏名、ID、年齢、性別、最終来院日などの基本情報を表形式で表示し、上部には検索フィルタ（氏名かな、ID、日付範囲など）を設けます。外来受付業務と連動する場合、当日受付患者のみを表示するモードと全患者表示モードを切り替えられるようにします。リストから患者を選択すると、その患者の詳細画面（カルテ画面）に遷移します。
* **患者詳細・診療記録ページ（カルテ画面）:** 個別患者の診療情報を扱うメイン画面です。この画面上で診療録の閲覧と入力、処方や検査オーダーの入力、バイタル確認などを行います。画面は大きく以下のエリアで構成します:

  * *患者プロファイル表示エリア:* 患者の基本情報（氏名、ID、生年月日、年齢、性別、血液型など）や保険情報、アレルギー・既往歴といった重要情報を画面上部に表示します。ここには直近のバイタルサインもハイライト表示し、一目で患者の状態を把握できるようにします。
  * *診療録入力エリア:* 医師が所見や所見所見・判断・処置内容を記録するテキストエリアです。SOAP形式のタブや区分けを用意し、入力済み文章を見やすく整理します。また定型文ボタンや過去記録からの引用機能を設け、迅速に記載できるUIとします。保存後の記録は日時順に下段リストに追加され、選択すると全文表示・編集（権限ある場合のみ）が可能です。
  * *処方入力エリア:* 現在の診察で処方する薬剤を入力する部分です。薬剤名や剤形、用量・用法を入力するフォームを設けます。薬剤マスターから検索・選択できるUIとし、複数薬剤をリスト形式で追加できます。併用禁忌チェックや過去薬歴との重複チェックが働いた場合は該当行をハイライトし警告表示します。処方入力内容は診療録と連動し、保存時にカルテ記載へ自動転記されます。
  * *検査／処置オーダー入力エリア:* 血液検査や画像検査、注射・処置等のオーダー内容を入力する部分です。よく使う検査項目についてはマスターから選択可能にし、自由記載もできるようにします。検査オーダー入力時にはオプションで検体ラベルの印刷を行うボタンや、外部検査システム送信のチェックボックスを配置します。オーダーも診療録と連動し、入力内容がカルテ記録に反映されます。
  * *過去診療記録一覧タブ:* 当該患者のこれまでの診療記録（日付、診療科、担当医ごと）を一覧表示するタブです。任意の日付の記録を選択して内容を表示できます。過去の処方や検査履歴もここから参照でき、継続処方の確認等に利用します。
* **患者登録・編集ページ:** 新患を登録したり患者情報を編集するためのページです。受付担当者や事務が使用します。基本情報（氏名、住所など）や保険証情報（保険者番号、被保険者証記号番号、負担割合など）を入力するフォームを提供します。将来的にオンライン資格確認システムで取得した保険情報を自動入力することも想定します。登録済み患者の情報更新（住所変更等）もこの画面から行います。
* **ユーザー管理ページ:** （プロトタイプ3以降）システム利用者アカウントを管理する管理者用ページです。ユーザーの新規登録（医師・看護師・事務などのロール設定含む）、権限変更、パスワードリセット等の機能を提供します。アクセス権限により表示項目を制御し、例えば管理者のみ本ページにアクセス可能とします。
* **監査ログ閲覧ページ:** （必要に応じて）システム内の操作ログや変更履歴を確認する管理者向け画面です。誰がいつどの患者カルテを閲覧/編集したか、重要データの変更履歴（例：診療記録の修正履歴）などを一覧でき、不正アクセスや誤操作の調査に用います。ログデータは基本的にシステム内部に蓄積し、必要な時にSQL等で抽出すれば十分なため、本画面は必須ではありませんが、GUIで提供すると監査業務の利便性が向上します。
* **帳票プレビュー・印刷ページ:** 紹介状や処方箋、領収書などを発行する際のプレビューページです。例えば処方箋発行ボタンからこのページを開き、発行内容を確認して印刷実行できるようにします。帳票ごとにテンプレートを持ち、患者情報や処方内容が所定の様式にレイアウトされます。紹介状作成の場合も同様に、転記された診療情報を編集・確認してから印刷または電子送信します。

*※上記の画面デザインは一例であり、実装段階ではUXの観点から適宜画面を統合・分割し、例えば「患者詳細ページ」で処方やオーダー入力まで完結できるオールインワン画面にすることも可能です。ただしPoC段階ではシンプルに画面を分けて実装し、ユーザビリティ評価を踏まえて段階的に改良します。*

## 段階的開発ステップと機能追加計画

プロジェクトを6つのフェーズ（プロトタイプ1～5、および+αの6）に分け、各段階で実装する機能群を定義します。初期のPoCではコアとなる最低限の機能に絞り、その後のフェーズで徐々に機能を充実させ、最終的に実用に耐える包括的な電子カルテシステムに仕上げます。

### **プロトタイプ1: 最小限PoCの実装**

**目的:** システムの基本概念を検証するため、最低限の電子カルテ機能を実装します。小規模クリニックでの日常利用を簡易にシミュレートできる程度の機能セットとします。

* **患者登録と一覧表示:** 単純な患者情報入力フォームを作成し、新規患者を登録可能にします。登録された患者のリストを画面に表示し、選択した患者のカルテ画面に遷移できるようにします（検索やソートは最低限で可）。
* **診療録の入力・保存:** テキストエリアによる診療記録入力欄を設け、自由形式でメモを記録できるようにします。入力内容はローカルのデータストア（例：インメモリまたはSQLiteなど）に保存し、再度患者を開いた際に過去記録を閲覧可能にします。SOAP区分などのUI分割はこの段階では簡略化し、自由記載1枠でも構いません。
* **処方入力欄（簡易版）:** 診療録ページ内に処方内容を記載する簡易欄を設置します。例えば「薬品名・用量・日数」をテキストで入力し、保存時に診療録本文へ「処方: ○○」のように追記される仕組みでも構いません。初期段階では厳密なデータ構造を持たずとも、処方情報をカルテに残すことが目的です。
* **バイタル入力（簡易版）:** 診療録ページにバイタル入力フィールド（例：体温、血圧、脈拍）を追加し、数値を保存・表示できるようにします。PoCでは各診療ごとの単一記録でも良いですが、データ構造上は日時とともに蓄積できるようにします。表示は診療録と別枠で最新値を見せる程度とします。
* **基本的なUIナビゲーション:** 上記ページ間を遷移できるメニューやボタンを実装します。例として、患者一覧→患者詳細（カルテ）→患者一覧 という戻り導線や、新規患者登録ボタンなど。
* **単一ユーザ動作:** この段階ではログイン機構は設けず、想定ユーザ1人（管理者兼医師）で使う前提とします。認証無しで画面に入れる状態ですが、PoC環境は閉域であり問題ない想定です（後続フェーズで認証実装）。

*このプロトタイプ1により、患者の基本情報登録から診療記録入力・保存まで、一通りの流れを実現します。開発者はまずこの小さい範囲で全体のアーキテクチャを確認し、Python+TypeScript間の通信やデータ保存の方針を固めます。*

### **プロトタイプ2: 基本機能の拡充**

**目的:** PoCで確認したコア機能に、クリニック運用上必要となる機能を追加します。データの構造化や業務上の抜け漏れ補填を行い、最低限から一歩進んだ使い勝手を実現します。

* **データ永続化の強化:** PoCでは簡易に保存していたデータを、本格的なRDBMS（例：PostgreSQL/MySQL）に移行して永続化します。これによりデータ件数が増えても耐えられるようにし、検索や参照のパフォーマンスも向上させます。
* **患者検索・ソート機能:** 患者一覧ページに検索BOXや並べ替えオプションを追加し、患者数が増えても目的の患者を迅速に見つけられるようにします。例えば名前の一部での検索、IDでの直接検索、並べ替えは五十音順と来院日時順を実装します。
* **診療録入力UIの改善:** SOAP形式の入力欄を試験的に導入し、「主観症状」「他覚所見」「診断・評価」「治療方針」の区分ごとにテキストを入力できるフォームに改善します。各項目はまとめて保存され、表示時には見出しを付けて区切ることで、紙カルテのように段落構造で見やすくします。履歴一覧も見出し付きで表示し、長文でもスクロールしやすいUIにします。
* **マスタの導入（薬剤・検査リスト）:** 処方入力や検査オーダー入力において、代表的な薬剤名や検査項目をリストから選択できるようにします。例えば頻用薬について数十種のマスタを用意し、入力フィールドで数文字タイプすると候補がドロップダウン表示される仕組みです。これにより入力ミスを減らし、将来的なコード化に備えます。
* **処方箋様式の出力:** 院外処方箋を印刷できるよう、処方入力内容から所定様式のPDFを生成する機能を追加します（試作レベル）。日本の**院外処方箋様式**に準拠し、患者情報・医療機関情報・薬剤情報をレイアウトします。まずはプレビュー画面にPDFを表示し、ブラウザの印刷機能で出力する形でも構いません。これにより本システム単体で処方箋発行まで完結でき、実務利用のイメージに近づきます。
* **簡易チェック機能:** 処方入力時に**重複チェック**（同じ薬の重複処方）や**基本的な投与量チェック**（非常識な高用量など）の簡易アラートを試験導入します。専門的な薬剤相互作用データベース連携はまだ行いませんが、同一成分名の重複検出程度は実装可能です。検査オーダーについても、例えば「直近同じ検査が何日以内に実施されていたら警告」といった簡易ルールを設定できます。
* **既往歴・アレルギー登録:** 患者基本情報に、既往歴やアレルギー情報を入力・編集するフォームを追加します。診療録ページの患者プロファイル表示部にこれら情報を表示し、医師が常に確認できるようにします。アレルギー情報は処方チェックとも連動し、該当薬剤処方時に警告を出す準備を整えます。

### **プロトタイプ3: ユーザ管理とセキュリティ強化**

**目的:** 複数ユーザでシステムを利用できるようにし、医療情報システムとして必要なセキュリティ機能を導入します。認証や監査ログにより、安全性・信頼性を向上させます。

* **ユーザ認証とアクセス制御:** ログイン画面を実装し、ユーザごとにID・パスワードで認証する方式に移行します。ユーザにはロール（医師、看護師、事務、管理者等）を設定し、ロールに応じてアクセス可能な機能・画面を制限します。例）看護師は診療録の参照はできるが編集は不可、管理者のみユーザ管理画面にアクセス可 等。認証にはセッション管理を導入し、一定時間非操作時のタイムアウトも設定します。
* **操作ログ・監査証跡:** システム内の重要な操作（診療録の新規作成・修正、処方内容の変更、ユーザ管理操作など）について日時・ユーザを記録する監査ログ機能を本格導入します。これにより誰がどの情報を扱ったか追跡可能となり、不正や事故発生時の検証が可能になります。ログはデータベースに保存し、管理者が照会できるようにします（照会画面のUIは簡易でも可）。
* **権限に応じたUI出し分け:** ロールごとにメニュー表示や編集可否を制御します。例えば事務ユーザには患者登録ページのみ表示し、カルテ閲覧権限を持たないようにする、看護師にはバイタル入力欄のみ編集可とする等、細かな制御を実装します。
* **セキュリティ通信:** Webアプリケーションとしてのセキュリティ強化策を講じます。具体的には通信の暗号化（HTTPS対応）、HTTPヘッダのセキュリティ設定（XSS対策、CSRFトークンの導入）等を行います。オンプレミス環境とはいえ院内LAN経由での漏洩に備え、可能な限りの対策を取ります。
* **データバックアップ計画:** システムの信頼性向上のため、定期的なデータバックアップの仕組みを導入検討します。具体的にはデータベースの自動バックアップスクリプトやエクスポート機能を用意します（手動でもCronでも可）。本番稼働時を見据え、この時点でバックアップ/リストア手順を整備します。

### **プロトタイプ4: レセコン（ORCA）連携と医事会計機能**

**目的:** 日本の診療所で必須となるレセプト請求業務に対応するため、日医標準レセプトソフト **ORCA** との連携機能を実装します。これにより診療から会計までの流れをシームレスにし、事務作業の効率化を図ります。

* **患者基本情報連携（ORCA ⇔ カルテ）:** ORCA側の患者登録情報と電子カルテ側を同期させます。新患をカルテで登録した際にORCAにも登録データを送信、また受付段階でORCAに登録済みの患者をカルテに呼び出すことができるように、ORCAのAPIやデータ連携機構を利用します。これにより受付で入力した患者データを共有し、カルテと会計での二重入力を防ぎます。
* **診療行為情報のORCA送信:** 医師がカルテに記録した診療内容（診療行為、処置、検査、薬剤処方など）をもとに、ORCAへ算定データを自動送信します。具体的には、カルテで処方オーダーや検査オーダーを確定したタイミングで、その情報をORCAの「診療行為入力」画面に反映させます。ORCA連携にはWebORCAの公開APIや、ORCA連携用の中間ファイル（ORCAのORCADBへの直接書込みは避け、公式手順に従う）を活用します。これにより診療終了後に事務が改めてORCAに入力し直す手間を省きます。
* **算定ルール対応:** カルテからORCA送信する情報には、保険算定上必要な要素（病名の確定、投与日数制限チェック、併算定禁止チェック等）を満たすようにします。例えば傷病名が未入力のまま処方送信しようとした場合に警告する、処置と薬剤の組み合わせでレセプト上問題がある場合に通知する等、可能な範囲で実装します。最終的な点数算定自体はORCAが行いますが、電子カルテ側でも入力漏れを防ぐためのバリデーションを取り入れます。
* **レセプト/会計情報フィードバック:** ORCAで算定・会計処理が完了した後、その情報をカルテ側にフィードバックする仕組みを検討します。例えば「会計済フラグ」や、「次回来院推奨日」等をカルテに表示することで、医師も患者の会計状況を把握できます。ORCAとの一体的な運用により、**診療から会計への連携がスムーズになり事務作業が飛躍的に軽減される**効果が期待できます。
* **薬剤マスタ・診療行為マスタ連携:** ORCAが持つ薬剤・診療行為マスターデータを参照し、電子カルテの入力補完に活用します。これにより全国共通のコード体系でデータ管理でき、将来的なデータ標準化にもつながります。薬価改定などマスター更新時にはORCAからデータを取り込みカルテ側も更新する運用とします。
* **帳票類の充実:** ORCA連携に伴い、レセプトや診療報酬明細書の出力はORCAで行うことになりますが、電子カルテ側でも患者向けの会計書（領収証、診療明細）を発行できるようにします。ORCAから算定情報を受け取り、カルテ内で領収証を印刷するか、あるいはORCAの画面を呼び出せる導線を用意します。どちらにせよ、**ORCAから電子カルテを起動・制御**したり電子カルテからORCAを呼び出すといった連携のUI面も整備します。
* **オンライン資格確認との連携準備:** ORCA経由でオンライン資格確認システム（マイナンバーカードによる被保険者資格確認）を利用するケースに対応し、資格確認結果（患者の負担区分や特定健診情報）を電子カルテに取り込む仕組みも検討します。ただし具体的なAPI公開状況によりますので、この段階ではORCA側で取得した情報をカルテ内で参照する程度に留めます。

### **プロトタイプ5: 標準規格対応・システム連携拡張**

**目的:** システムの対外的なインターフェースを整備し、他の医療情報システムや地域連携プラットフォームとのデータ交換を可能にします。具体的にはFHIRを用いた標準API提供や、SS-MIX2形式のデータエクスポート等に対応します。また、検査・画像連携など院内外システム統合を完成させます。

* **FHIRベースAPIの実装:** 国際標準であるHL7 FHIRに準拠したWeb APIを公開します。Patientリソース（患者基本情報）、Observationリソース（バイタルや検査結果）、Conditionリソース（診断名）、MedicationRequestリソース（処方箋）等、主要な医療データについてRESTful APIエンドポイントを実装します。これにより異なるシステム間でも患者データのやり取りが可能となり、将来的な全国医療情報プラットフォームとの接続も容易になります。
* **地域連携・情報共有対応:** 厚労省が推進する**電子カルテ情報共有サービス**等の地域連携プラットフォームに接続できるよう、必要な機能を実装します。具体的には、患者の同意のもとで他院と共有すべき情報（3文書6情報: 診療情報提供書、サマリー、健診結果報告書 + 病名・アレルギー・感染症・禁忌薬・検査・処方情報）を抽出・送信する機能、および他システムから提供された患者情報を受信・表示する機能です。例えば紹介先医療機関から電子的に紹介状を受け取って自院のカルテに取り込む、救急時に他院の処方歴を閲覧する、といったことが可能になります。
* **SS-MIX2標準ストレージ対応:** 国内標準規格であるSS-MIX2形式でのデータ保存/エクスポートに対応します。院内で収集された診療データをSS-MIX2の標準化ストレージに蓄積し、必要に応じて二次利用や研究用途に提供できるようにします。具体的には、患者ごと・受診日ごとのフォルダ階層を作成し、HL7 v2形式のテキストデータ（ADT、ORUメッセージなど）やPDFを所定の形式で出力します。これにより院内データを他システムへ容易に受け渡すことが可能になります（例：院内でSS-MIX2対応データベースに自動集積し、AI分析に利用）。
* **検体検査システム連携の完成:** プロトタイプ4で着手した外部検査会社等との連携を完了させます。具体的には、電子カルテ上で検査オーダー登録時に自動で検査依頼情報を外部検査システムへ送信し、検査結果データ（HL7 ORUメッセージ等）が返ってきたら対応する患者カルテに結果を取り込みます。結果は観察項目ごとに時系列で閲覧でき、異常値にはハイライトを付ける等の工夫をします。これにより検査結果管理が電子カルテ内で完結し、紙の結果レポート取り込みが不要になります。
* **医用画像(PACS)連携の完成:** DICOM通信を用いて院内のPACSまたはモダリティから画像を取得し、カルテ画面で表示する機能を完成させます。放射線画像ビューワの組み込みや、キー画像のカルテ添付保存機能も実装します。例えばレントゲン撮影後、自動的にカルテ上に該当患者の画像サムネイルが表示され、クリックで高解像度画像ビューアを起動できるようにします。これにより画像所見と臨床所見の統合的な参照が可能になります。
* **高度なセキュリティと監査:** 標準API公開や外部連携に伴い、システムのセキュリティもさらに強化します。外部APIアクセスの認可認証（OAuth2.0やAPIキー管理）、アクセスログモニタリング、不正アクセス検知の仕組みなどを導入します。また、カルテ修正履歴の比較表示（誰がどの箇所をどう変更したか差分表示）機能や、監査ログのエクスポート機能など、運用上便利なツールも追加します。
* **パフォーマンスと信頼性向上:** 利用ユーザ数やデータ件数の増大を見据え、システム全体のパフォーマンスチューニングを行います。インデックス最適化やキャッシュ導入、負荷テストによるボトルネック解消などに取り組みます。また障害時のフェイルセーフ策（例：定期バックアップ＋リストア手順リハーサル、レプリケーション検討）についても文書化・整備し、クリティカルな医療インフラとして信頼性を高めます。

### **プロトタイプ6 (+α): AI連携・更なる高度化**

**目的:** 最新技術であるAI（人工知能）や機械学習を活用し、医療現場の支援機能を組み込むフェーズです。また、必須ではないが付加価値を提供する高度機能を実験的に実装します。プロトタイプ6はオプション扱いであり、プロトタイプ5までで完成した電子カルテに対する発展的拡張となります。

* **医用画像AI解析の統合:** Pydicom等で取得した医用画像データに対し、ディープラーニングモデルを用いた解析を行います。例えば胸部X線画像から肺炎の兆候を検出するAI、内視鏡画像からポリープを検出するAIなどを組み込み、画像所見作成を支援します。医師が画像をビューアで表示した際に「AI所見候補」を表示し、診断の参考情報として提供します。ただし最終判断は医師が行う前提で、AI結果はあくまで補助として位置付けます。
* **診療内容の音声入力・NLP支援:** 医師の負担軽減のため、音声認識による診療記録入力や自然言語処理による要約機能を試験導入します。音声入力ではマイクから医師の話すカルテ記載内容をテキスト化し、その場で編集・保存可能にします。NLP要約機能では長大な過去カルテ記録から重要ポイントを抽出し、短時間で経過を把握できるようにします。また、対話型AIによる問診支援（患者からの訴えをAIが整理してカルテに提案）なども考えられます。
* **診療アシストAI（意思決定支援）:** 患者の病状や検査結果に応じて、AIが考えられる鑑別診断や推奨される追加検査を提示する機能です。例えば発熱と咳の症状・所見から「可能性のある疾患: ○○、△△。念のため胸部レントゲン検査を検討してください」等の提案を行います。これは医学知識ベースと機械学習を組み合わせ、カルテ入力内容をリアルタイム解析して提示するイメージです。医師の意思決定を補強し、見逃し防止や医療の質向上につなげます。
* **予測分析・医療データ二次利用:** 蓄積された診療データをAIで解析し、将来のリスク予測や経営分析に役立てる機能です。例えば患者ごとの再来院予測、疾患の流行トレンド分析、クリニック経営指標の自動レポート作成などを行います。これにはSS-MIX2標準ストレージに集積したデータも活用し、匿名化した上で研究用途に提供する仕組みも検討します。
* **SS-MIX2完全対応:** プロトタイプ5で導入したSS-MIX2機能を高度化し、運用レベルで完全に対応させます。具体的には、診療終了ごとに自動でSS-MIX2フォルダに当該患者の当日分データを書き出す、退院サマリや紹介状作成時にSS-MIX2に格納する、などのワークフローを整備します。これにより地域のデータ連携基盤や研究機関へのデータ提供がスムーズになります。
* **その他の高度機能:**

  * **モバイル対応:** タブレットやスマートフォンからカルテを閲覧・入力できるようにレスポンシブ対応や専用UIを検討します。在宅診療や往診時にタブレットで利用できれば医師の利便性が向上します。
  * **多言語対応:** インバウンド患者や外国人対応のため、UIや主要帳票の多言語化を行います。医療用語の翻訳辞書を用意し、英語をはじめ必要な言語で表示できるようにします。
  * **プラグイン/モジュール機構:** オープンソースである利点を活かし、外部開発者が機能拡張できるプラグイン仕組みを導入します。例えば特定科向けのモジュール（眼科検査データ管理など）を追加できるようにし、基本機能はそのままに各クリニックのニーズに応じカスタマイズ可能とします。
  * **クラウド/オンプレハイブリッド:** 基本はオンプレ運用ですが、災害対策や遠隔アクセスのため、一部データのクラウドバックアップやクラウド上の分析サービス活用も検討します。ただし医療DXにおけるクラウド活用は通信遮断時のリスクやセキュリティ課題もあるため、必要最低限の範囲に留めます。
