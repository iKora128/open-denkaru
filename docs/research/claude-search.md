# 日本版オープンソース電子カルテシステム要件定義書

## 1. プロジェクト概要

### 1.1 背景と目的
- **背景**: 既存のOpenEMRなどのオープンソースEMRは機能的には充実しているが、レガシーアーキテクチャ、日本の医療制度への適合性不足、コントリビュートの困難さなどの課題を抱えている
- **目的**: 日本の医療制度に完全対応し、モダンな技術スタックで構築された、開発者フレンドリーなオープンソース電子カルテシステムの新規開発

### 1.2 ビジョン
- **開発者ファースト**: エンジニアや医師が簡単に修正・拡張できる設計
- **モジュール化**: 必要な機能を選択的に導入できる柔軟性
- **日本医療特化**: 保険診療、レセプト、日本語対応を前提とした設計
- **コミュニティ駆動**: GitHubを中心とした活発な開発コミュニティの形成

## 2. 法的要件（必須要件）

### 2.1 電子カルテの3原則
1. **真正性の確保**
   - 作成者の識別と認証（電子署名対応）
   - 改ざん防止（ブロックチェーン技術の活用検討）
   - 変更履歴の完全記録

2. **見読性の確保**
   - 必要時の迅速な表示（2秒以内）
   - PDF/印刷出力機能
   - 長期保存フォーマット対応

3. **保存性の確保**
   - 法定保存期間対応（診療録5年、その他各種期限）
   - バックアップとリストア機能
   - データ移行ツールの提供

### 2.2 医療情報システム安全管理ガイドライン第6.0版準拠
- ゼロトラストセキュリティモデル
- 二要素認証（2027年度義務化対応）
- 包括的な監査ログ機能

### 2.3 個人情報保護法対応
- 要配慮個人情報の適切な管理
- 患者同意管理機能
- データポータビリティ対応

## 3. 機能要件

### 3.1 最小限実装機能（Phase 1: PoC）

#### 患者管理機能
```
- 患者基本情報登録・編集
- 保険情報管理
- 来院履歴
- 簡易検索機能
```

#### 診療記録機能（SOAP形式）
```
- S: 主観的情報（患者の訴え）
- O: 客観的情報（検査結果、バイタル）
- A: 評価（診断）
- P: 計画（治療方針）
```

#### ユーザー管理・認証
```
- ログイン/ログアウト
- 基本的な権限管理
- セッション管理
```

### 3.2 基本機能（Phase 2: プロトタイプ）

#### 処方管理
```
- 薬剤マスター連携
- 処方箋発行
- 薬歴管理
- 相互作用チェック（基本）
```

#### 検査オーダー・結果管理
```
- 院内検査オーダー
- 外注検査連携
- 結果取り込み・表示
- 異常値アラート
```

#### レセプト連携
```
- レセコンとの基本連携
- 診療行為入力
- 病名登録
```

### 3.3 拡張機能（Phase 3-4: 本番向け）

#### 高度な臨床支援
```
- 電子処方箋対応
- DICOM画像連携
- 検査結果トレンド表示
- 臨床意思決定支援（CDS）
```

#### 地域医療連携
```
- SS-MIX2対応
- 地域医療ネットワーク連携
- 紹介状作成・管理
```

#### 分析・レポート
```
- 診療統計
- 経営分析
- カスタムレポート作成
```

### 3.4 アドバンスド機能（Phase 5: 将来拡張）

#### AI/ML統合
```
- 診断支援AI連携
- 音声認識カルテ入力
- 自然言語処理による要約
- 予測分析
```

#### 高度な相互運用性
```
- HL7 FHIR完全準拠
- 国際標準対応
- マルチ施設対応
```

## 4. 技術要件

### 4.1 アーキテクチャ設計原則

#### マイクロサービスアーキテクチャ
```yaml
services:
  - patient-service      # 患者管理
  - clinical-service     # 診療記録
  - prescription-service # 処方管理
  - billing-service      # 請求管理
  - auth-service        # 認証・認可
  - notification-service # 通知管理
```

#### API設計
- **RESTful API**: 基本的なCRUD操作
- **GraphQL**: 複雑なデータ取得
- **WebSocket**: リアルタイム通信
- **gRPC**: サービス間通信

### 4.2 技術スタック

#### バックエンド
```python
# 推奨構成
Framework: FastAPI (高性能API) + Django (管理画面)
Language: Python 3.11+
Database: PostgreSQL (メイン) + Redis (キャッシュ)
Message Queue: RabbitMQ or Kafka
```

#### フロントエンド
```typescript
// 推奨構成
Framework: Next.js 14+ (React)
Language: TypeScript
State Management: Zustand or Redux Toolkit
UI Library: Shadcn/ui + Tailwind CSS
```

#### インフラストラクチャ
```yaml
Container: Docker
Orchestration: Kubernetes
CI/CD: GitHub Actions
Monitoring: Prometheus + Grafana
Logging: ELK Stack
```

### 4.3 データモデル設計

#### 主要エンティティ
```sql
-- 患者
Patient {
  id: UUID
  patient_id: String (病院内ID)
  name: String
  kana: String
  birth_date: Date
  gender: Enum
  created_at: Timestamp
  updated_at: Timestamp
}

-- 診療記録
ClinicalRecord {
  id: UUID
  patient_id: UUID
  encounter_id: UUID
  soap_subjective: Text
  soap_objective: JSONB
  soap_assessment: Text
  soap_plan: Text
  created_by: UUID
  created_at: Timestamp
}

-- 処方
Prescription {
  id: UUID
  patient_id: UUID
  encounter_id: UUID
  medication_code: String
  dosage: JSONB
  duration: Integer
  instructions: Text
}
```

## 5. 非機能要件

### 5.1 パフォーマンス要件
- レスポンスタイム: 平均2秒以内（緊急時500ms以内）
- 同時接続数: 100-1000ユーザー
- 可用性: 99.9%（年間ダウンタイム8.76時間以内）
- データ処理: 10,000 TPS

### 5.2 セキュリティ要件
- エンドツーエンド暗号化
- RBAC（Role-Based Access Control）
- 監査ログの完全記録
- 定期的なセキュリティ監査

### 5.3 ユーザビリティ要件
- 直感的なUI/UX
- レスポンシブデザイン
- アクセシビリティ対応（WCAG 2.1 AA準拠）
- 多言語対応（日本語・英語）

## 6. 開発ロードマップ

### Phase 1: PoC（3ヶ月）
```
月1: 環境構築、基本設計
月2: 患者管理、診療記録の基本実装
月3: 認証機能、基本UI実装
```

### Phase 2: Alpha版（3ヶ月）
```
月4: 処方管理機能
月5: 検査管理機能
月6: レセコン連携基礎
```

### Phase 3: Beta版（6ヶ月）
```
月7-8: DICOM連携、画像管理
月9-10: 高度なセキュリティ機能
月11-12: パフォーマンス最適化
```

### Phase 4: 正式版（6ヶ月）
```
月13-15: 地域医療連携機能
月16-18: 本番運用準備、移行ツール
```

### Phase 5: 拡張版（継続的）
```
- AI/ML機能統合
- 国際標準対応
- マルチテナント対応
```

## 7. プロジェクト体制

### 7.1 開発体制
- **コアチーム**: 5-10名（フルタイムエンジニア）
- **コントリビューター**: オープンソースコミュニティ
- **医療アドバイザー**: 現役医師3-5名
- **法務・コンプライアンス**: 1-2名

### 7.2 ガバナンス
- **ライセンス**: MIT or Apache 2.0
- **コントリビューションガイドライン**: 明確な貢献ルール
- **コードレビュープロセス**: 2名以上のレビュー必須
- **リリースサイクル**: 月次マイナー、四半期メジャー

## 8. 成功指標

### 8.1 技術的指標
- コードカバレッジ: 80%以上
- バグ修正時間: 重大24時間、通常72時間以内
- API応答時間: 95パーセンタイル2秒以内

### 8.2 採用指標
- GitHub Stars: 1年で1,000以上
- アクティブコントリビューター: 50名以上
- 導入医療機関: 1年で10施設以上

### 8.3 コミュニティ指標
- 月次アクティブ開発者: 20名以上
- プルリクエスト処理時間: 1週間以内
- ドキュメント完成度: 90%以上

## 9. リスクと対策

### 9.1 技術的リスク
- **リスク**: レガシーシステムからの移行困難
- **対策**: 段階的移行ツール、並行運用サポート

### 9.2 法的リスク
- **リスク**: 医療法規制の変更
- **対策**: 柔軟な設定システム、定期的な法務レビュー

### 9.3 採用リスク
- **リスク**: 保守的な医療機関の抵抗
- **対策**: 成功事例の積極的共有、手厚いサポート体制

## 10. 次のステップ

1. **技術検証**: FastAPI + Next.jsでの基本プロトタイプ作成（2週間）
2. **コミュニティ形成**: GitHubリポジトリ公開、初期コントリビューター募集
3. **資金調達**: オープンソース財団、医療系ファンド、クラウドファンディング
4. **パートナーシップ**: 医療機関、大学、IT企業との連携構築